-- Ultimate Roblox Super AI with Conversational Personality
-- Fully-featured: Fly, Speed, Jump, Sit, Teleport, Reset, Noclip
-- Learns commands & scripts, predicts actions, generates scripts from natural language
-- Conversational GUI integrated

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Flying Setup
local flying = false
local flySpeed = 50
local velocity = Instance.new("BodyVelocity")
velocity.MaxForce = Vector3.new(400000,400000,400000)
velocity.Velocity = Vector3.new(0,0,0)

-- GUI Setup
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "SuperAI_GUI"

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(0,400,0,50)
textBox.Position = UDim2.new(0.5,-200,0,50)
textBox.PlaceholderText = "Type commands or instructions..."
textBox.ClearTextOnFocus = true
textBox.Text = ""
textBox.Parent = screenGui

local chatLabel = Instance.new("TextLabel")
chatLabel.Size = UDim2.new(0,400,0,70)
chatLabel.Position = UDim2.new(0.5,-200,0,110)
chatLabel.BackgroundTransparency = 0.5
chatLabel.BackgroundColor3 = Color3.fromRGB(30,30,30)
chatLabel.TextColor3 = Color3.fromRGB(255,255,255)
chatLabel.TextScaled = true
chatLabel.TextWrapped = true
chatLabel.Text = ""
chatLabel.Parent = screenGui

-- Command Definitions
local commandInfo = {
    fly = "Fly: 'Fly high' or 'Stop flying'",
    speed = "Set WalkSpeed: 'fast', 'slow', 'super fast'",
    jump = "Jump: 'Jump now'",
    sit = "Sit: 'Sit down'",
    teleport = "Teleport: 'Teleport me to PlayerName'",
    reset = "Reset speed & fly: 'Reset everything'",
    noclip = "Walk through objects: 'Enable noclip'"
}

local speedKeywords = {slow=20, normal=16, fast=50, ["super fast"]=100, ultra=150}
local flyKeywords = {low=30, normal=50, high=100, ["really high"]=150, ultra=200}

local learnedCommands = {}
local learnedScripts = {}
local behaviorMemory = {}

-- Helper Functions
local function mapKeywordSpeed(input, keywords, default)
    for k,v in pairs(keywords) do
        if input:match(k) then return v end
    end
    return default
end

local function AIReply(msg)
    chatLabel.Text = msg
    spawn(function()
        wait(5)
        if chatLabel.Text == msg then chatLabel.Text = "" end
    end)
end

-- Fly movement
RunService.RenderStepped:Connect(function()
    if flying then
        local camCF = workspace.CurrentCamera.CFrame
        local moveDir = Vector3.new()
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir = moveDir + Vector3.new(0,1,0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir = moveDir - Vector3.new(0,1,0) end
        if moveDir.Magnitude > 0 then
            velocity.Velocity = moveDir.Unit * flySpeed
        else
            velocity.Velocity = Vector3.new(0,0,0)
        end
    end
end)

-- Script Generator from Natural Language
local function GenerateScript(instruction)
    instruction = instruction:lower()
    if instruction:match("make a button") then
        return [[
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(0,100,0,50)
            button.Position = UDim2.new(0.5,-50,0.5,-25)
            button.Text = "Click Me!"
            button.Parent = game.Players.LocalPlayer.PlayerGui
        ]]
    elseif instruction:match("teleport pad") then
        return [[
            local part = Instance.new("Part")
            part.Size = Vector3.new(5,1,5)
            part.Position = game.Players.LocalPlayer.Character.HumanoidRootPart.Position + Vector3.new(0,0,10)
            part.Anchored = true
            part.BrickColor = BrickColor.new("Bright green")
            part.Parent = workspace
            part.Touched:Connect(function(hit)
                if hit.Parent:FindFirstChild("Humanoid") then
                    hit.Parent.HumanoidRootPart.CFrame = CFrame.new(hit.Position + Vector3.new(0,5,0))
                end
            end)
        ]]
    else
        return "-- Cannot generate script for instruction: "..instruction
    end
end

-- Predictive & Learning Engine
local lastJumpTime = 0
RunService.Heartbeat:Connect(function()
    if humanoid.Jump then
        if tick() - lastJumpTime < 2 then
            if not flying then
                flying = true
                velocity.Velocity = Vector3.new(0,0,0)
                velocity.Parent = rootPart
                AIReply("Predictive Fly: Detected repeated jumps. Fly enabled.")
            end
        end
        lastJumpTime = tick()
    end

    -- Predictive teleport and observation
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (p.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
            if dist < 15 and behaviorMemory[p.Name] and tick() - behaviorMemory[p.Name] < 10 then
                rootPart.CFrame = p.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
                AIReply("Predictive Teleport executed to "..p.Name)
            end
            behaviorMemory[p.Name] = tick()
        end
    end
end)

-- Parse Commands
local function parseCommand(input)
    local cmd = input:lower()
    local understood = false

    -- Help
    if cmd:match("help") or cmd:match("commands") then
        understood = true
        local list = "Commands:\n"
        for k,_ in pairs(commandInfo) do list=list.."- "..k.."\n" end
        for k,_ in pairs(learnedCommands) do list=list.."- "..k.." (learned)\n" end
        for k,_ in pairs(learnedScripts) do list=list.."- "..k.." (script)\n" end
        AIReply(list)
    end

    -- Fly
    if cmd:match("fly") then
        understood = true
        if cmd:match("stop") or cmd:match("disable") then
            if flying then flying=false velocity:Destroy() AIReply("Flying stopped!") else AIReply("Not flying yet.") end
        else
            flying=true
            flySpeed = mapKeywordSpeed(cmd, flyKeywords, 50)
            velocity.Velocity = Vector3.new(0,0,0)
            velocity.Parent = rootPart
            AIReply("Flying enabled at speed "..flySpeed)
        end
    end

    -- Speed
    if cmd:match("speed") or cmd:match("fast") or cmd:match("slow") then
        understood = true
        local speed = mapKeywordSpeed(cmd, speedKeywords, 50)
        humanoid.WalkSpeed = speed
        AIReply("WalkSpeed set to "..speed)
    end

    -- Jump
    if cmd:match("jump") then
        understood = true
        humanoid.Jump = true
        AIReply("Jumped!")
    end

    -- Sit
    if cmd:match("sit") then
        understood = true
        humanoid.Sit = true
        AIReply("Sitting now")
    end

    -- Reset
    if cmd:match("reset") or cmd:match("normal") then
        understood = true
        humanoid.WalkSpeed = 16
        if flying then flying = false velocity:Destroy() end
        AIReply("Reset speed and flying")
    end

    -- Teleport
    if cmd:match("teleport") then
        understood = true
        local targetName = cmd:match("to (%w+)")
        if targetName then
            local targetPlayer = Players:FindFirstChild(targetName)
            if targetPlayer and targetPlayer.Character then
                rootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
                AIReply("Teleported to "..targetName)
            else
                AIReply("Cannot find player "..targetName)
            end
        else
            AIReply("Specify player to teleport. Example: 'Teleport me to PlayerName'")
        end
    end

    -- Learned Commands
    if cmd:match("learn") and cmd:match("as") then
        local name, action = cmd:match("learn (.+) as (.+)")
        if name and action then
            learnedCommands[name] = {action = action}
            AIReply("Learned command: "..name)
            understood = true
        end
    end
    for k,v in pairs(learnedCommands) do
        if cmd:match(k) then
            understood = true
            AIReply("Executing learned command: "..k.." -> "..v.action)
        end
    end

    -- Learned Scripts
    if cmd:match("script") and cmd:match("as") then
        local name, code = cmd:match("script (.+) as (.+)")
        if name and code then
            learnedScripts[name] = code
            AIReply("Learned script: "..name)
            understood = true
        end
    end
    for name, code in pairs(learnedScripts) do
        if cmd:match(name) then
            understood = true
            local success, err = pcall(function() loadstring(code)() end)
            if success then
                AIReply("Executed script: "..name)
            else
                AIReply("Error running script: "..err)
            end
        end
    end

    -- On-the-spot Script Generation from Natural Language
    if cmd:match("generate script") or cmd:match("create") then
        local instruction = cmd:match("generate script (.+)") or cmd:match("create (.+)")
        if instruction then
            local code = GenerateScript(instruction)
            AIReply("Generated script for instruction: "..instruction)
            local success, err = pcall(function() loadstring(code)() end)
            if success then
                AIReply("Executed generated script successfully!")
            else
                AIReply("Error executing generated script: "..err)
            end
            understood = true
        end
    end

    -- If command not recognized
    if not understood then
        AIReply("I didn't understand that. Type 'help' for commands or teach me with 'learn <command> as <action>' or 'script <name> as <lua_code>'.")
    end
end

-- Connect TextBox to command parser
textBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        parseCommand(textBox.Text)
        textBox.Text = ""
    end
end)

-- Optional: AI conversational greeting
AIReply("Hello! I am your Super AI assistant. Type commands naturally, and I will help, predict, and generate scripts for you.")
